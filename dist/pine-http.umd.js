(function(s,t){typeof exports=="object"&&typeof module<"u"?module.exports=t():typeof define=="function"&&define.amd?define(t):(s=typeof globalThis<"u"?globalThis:s||self,s["pine-http"]=t())})(this,function(){"use strict";var u=Object.defineProperty;var d=(s,t,n)=>t in s?u(s,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):s[t]=n;var o=(s,t,n)=>(d(s,typeof t!="symbol"?t+"":t,n),n);class s{constructor(){o(this,"handlers",[])}use(e){return this.handlers.push(e),this.handlers.length-1}unUse(e){this.handlers.splice(e,1)}exec(e){return this.handlers.reduce((r,i,h)=>{var a;return r.then(i.resolveHandler,(a=this.handlers[h-1])==null?void 0:a.rejectHandler)},Promise.resolve(e)).catch(this.handlers[this.handlers.length-1].rejectHandler)}}const t={url:"",method:"GET",baseURL:"",headers:{},params:{},data:{},timeout:0,withCredentials:!1,responseType:"json"};class n{constructor(e){o(this,"_adapter");o(this,"_requestInterceptor");o(this,"_responseInterceptor");o(this,"_baseURL");this._adapter=e,this._requestInterceptor=new s,this._responseInterceptor=new s}static handleError(e){return typeof e=="string"?e:e instanceof Error?e.message:"\u670D\u52A1\u5668\u7E41\u5FD9\uFF0C\u8BF7\u7A0D\u540E\u518D\u8BD5"}get interceptor(){return{request:this._requestInterceptor,response:this._responseInterceptor}}get(e){return e.method="GET",this.request(e)}post(e){return e.method="POST",this.request(e)}async request(e){try{if(!e.url)throw new Error("url is not found");const r=this._mergeConfig(e),i=await this._requestInterceptor.exec(r),h=await this._adapter.send(i);return await this._responseInterceptor.exec(h)}catch(r){return Promise.reject(n.handleError(r))}}setBaseUrl(e){e!==void 0&&(this._baseURL=e)}_mergeConfig(e){var i;this.setBaseUrl(e.baseURL);const r=Object.assign(t,e);return r.method=(i=r.method)==null?void 0:i.toUpperCase(),r.url=this._getUrl(r.url),r}_getUrl(e){return this._baseURL!==void 0&&!e.startsWith("http")?(e.startsWith("/")&&(e=e.substring(1)),`${this._baseURL}/${e}`):e}}return n});
